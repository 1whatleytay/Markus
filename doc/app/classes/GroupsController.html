<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: GroupsController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">GroupsController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/groups_controller_rb.html">
                app/controllers/groups_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Manages actions relating to editing and modifying groups.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000148">add_csv_group</a>&nbsp;&nbsp;
      <a href="#M000143">add_group</a>&nbsp;&nbsp;
      <a href="#M000141">add_member</a>&nbsp;&nbsp;
      <a href="#M000137">creategroup</a>&nbsp;&nbsp;
      <a href="#M000147">csv_upload</a>&nbsp;&nbsp;
      <a href="#M000140">decline_invitation</a>&nbsp;&nbsp;
      <a href="#M000149">download_grouplist</a>&nbsp;&nbsp;
      <a href="#M000135">index</a>&nbsp;&nbsp;
      <a href="#M000138">invite_member</a>&nbsp;&nbsp;
      <a href="#M000139">join</a>&nbsp;&nbsp;
      <a href="#M000146">manage</a>&nbsp;&nbsp;
      <a href="#M000144">remove_group</a>&nbsp;&nbsp;
      <a href="#M000142">remove_member</a>&nbsp;&nbsp;
      <a href="#M000145">rename_group</a>&nbsp;&nbsp;
      <a href="#M000136">student_interface</a>&nbsp;&nbsp;
      <a href="#M000150">use_another_assignment_groups</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000148" class="method-detail">
        <a name="M000148"></a>

        <div class="method-heading">
          <a href="#M000148" class="method-signature">
          <span class="method-name">add_csv_group</span><span class="method-args">(members, assignment)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Helper method to add the listed memebers.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000148-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000148-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 377</span>
377:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_csv_group</span> (<span class="ruby-identifier">members</span>, <span class="ruby-identifier">assignment</span>)
378:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">members</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
379: 
380:                 <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">new</span>
381:                 <span class="ruby-identifier">group</span>.<span class="ruby-identifier">assignments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">assignment</span>
382:                 <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-comment cmt"># skip validation requiring groups to have at least 1 member</span>
383:                 
384:                 <span class="ruby-comment cmt"># Set default group name. (Just Testing) </span>
385:                 <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_name</span> = <span class="ruby-value str">&quot;group_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> 
386:                 
387:                 <span class="ruby-comment cmt"># Add first member to group.  </span>
388:     <span class="ruby-identifier">member</span> = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">invite</span>(<span class="ruby-identifier">members</span>[<span class="ruby-value">0</span>], <span class="ruby-value str">'inviter'</span>)
389:         
390:         <span class="ruby-comment cmt"># Add the rest of the members</span>
391:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">invite</span>(<span class="ruby-identifier">members</span>[<span class="ruby-value">1</span>,<span class="ruby-identifier">members</span>.<span class="ruby-identifier">length</span>], <span class="ruby-value str">'accepted'</span>)
392:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000143" class="method-detail">
        <a name="M000143"></a>

        <div class="method-heading">
          <a href="#M000143" class="method-signature">
          <span class="method-name">add_group</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000143-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000143-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 234</span>
234:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_group</span>
235:     
236:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
237:     <span class="ruby-comment cmt"># Create new group for this assignment</span>
238:     <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">new</span>
239:     <span class="ruby-comment cmt"># Set default group name. (Just Testing)      </span>
240:     <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-comment cmt"># skip validation requiring groups to have at least 1 member </span>
241:     <span class="ruby-comment cmt"># We need to save before we can get an ID for this group.</span>
242:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">group_name_autogenerated</span>
243:       <span class="ruby-comment cmt"># Create new group for this assignment</span>
244:       <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">new</span>
245:       <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-comment cmt"># skip validation requiring groups to have at least 1 member </span>
246:       <span class="ruby-comment cmt"># We need to save before we can get an ID for this group.</span>
247:       <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_name</span> = <span class="ruby-value str">&quot;group_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>    
248:       <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span> <span class="ruby-comment cmt"># Second save, to preserve the name</span>
249:     <span class="ruby-keyword kw">else</span> 
250:       <span class="ruby-comment cmt">#test if a group with this name already exists</span>
251:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:group_name</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:new_group_name</span>]]})
252:         <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:group_name</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:new_group_name</span>]]})
253:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:assignment_id</span>] = <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
254:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group_id</span>] = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>
255:         
256:         <span class="ruby-comment cmt">#test if a grouping is already linked to this group</span>
257:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;assignment_id =:assignment_id and group_id = :group_id&quot;</span>, {<span class="ruby-identifier">:group_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:assignment_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>}])
258:            <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:fail_notice</span>] = <span class="ruby-value str">&quot;This name is already uses for this
259:            assignement&quot;</span>
260:            <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
261:               <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'manage'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
262:            <span class="ruby-keyword kw">end</span>
263:            <span class="ruby-keyword kw">return</span>
264:       <span class="ruby-keyword kw">end</span>
265:       <span class="ruby-keyword kw">else</span>
266:         <span class="ruby-comment cmt"># Create new group for this assignment</span>
267:         <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">new</span>
268:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-comment cmt"># skip validation requiring groups to have at least 1 member </span>
269:         <span class="ruby-comment cmt"># We need to save before we can get an ID for this group.</span>
270:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:new_group_name</span>]    
271:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span> <span class="ruby-comment cmt"># Second save, to preserve the name</span>
272:       <span class="ruby-keyword kw">end</span>
273:     <span class="ruby-keyword kw">end</span> 
274:     <span class="ruby-identifier">grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">new</span>
275:     <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">group</span> = <span class="ruby-identifier">group</span>
276:     <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">assignment</span> = <span class="ruby-ivar">@assignment</span>
277:     <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">save</span>
278:                 
279:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
280:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'manage'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
281:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">:focusText</span>, <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>)
282:     <span class="ruby-keyword kw">end</span>
283:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000141" class="method-detail">
        <a name="M000141"></a>

        <div class="method-heading">
          <a href="#M000141" class="method-signature">
          <span class="method-name">add_member</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Group.html">Group</a> administration functions
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
Verify that all functions below are included in the authorize filter above
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000141-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000141-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 167</span>
167:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_member</span>
168:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:student</span>][<span class="ruby-identifier">:user_name</span>])
169:     <span class="ruby-comment cmt"># add member to the group with status depending if group is empty or not</span>
170:     <span class="ruby-identifier">grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:grouping_id</span>])
171:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
172:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">group_max</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">membership_number</span>
173:         <span class="ruby-identifier">membership_status</span> = <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">student_memberships</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-value str">'inviter'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'accepted'</span>
174:         <span class="ruby-identifier">member</span> = <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">invite</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:student</span>][<span class="ruby-identifier">:user_name</span>],
175:         <span class="ruby-identifier">membership_status</span>) 
176:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
177:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">valid_with_base?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">save</span>
178:         <span class="ruby-comment cmt"># add member to the group list</span>
179:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">insert_html</span> <span class="ruby-identifier">:bottom</span>, <span class="ruby-node">&quot;grouping_#{grouping.id}_list&quot;</span>, 
180:           <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'groups/manage/member'</span>, <span class="ruby-identifier">:locals</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:grouping</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">grouping</span>, <span class="ruby-identifier">:member</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">member</span>}
181:         <span class="ruby-comment cmt"># remove from 'no group' list if in there</span>
182:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-node">&quot;user_#{params[:student][:user_name]}&quot;</span>
183:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">:clearText</span>, <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>)  <span class="ruby-comment cmt"># clear text</span>
184:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span>(<span class="ruby-node">&quot;error_#{grouping.id}&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>)  <span class="ruby-comment cmt"># clear errors</span>
185:       <span class="ruby-keyword kw">else</span>
186:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-node">&quot;error_#{grouping.id}&quot;</span>,
187:           <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'groups/error_single'</span>, <span class="ruby-identifier">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:objekt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">grouping</span> }
188:       <span class="ruby-keyword kw">end</span>
189:     <span class="ruby-keyword kw">end</span>
190:     <span class="ruby-keyword kw">else</span>
191:        <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:fail_notice</span>] = <span class="ruby-value str">&quot;There is already the maximum number of
192:        person in this group&quot;</span>
193:        <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
194:           <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:manage</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
195:        <span class="ruby-keyword kw">end</span>
196:     <span class="ruby-keyword kw">end</span>
197:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000137" class="method-detail">
        <a name="M000137"></a>

        <div class="method-heading">
          <a href="#M000137" class="method-signature">
          <span class="method-name">creategroup</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Group.html">Group</a> management functions
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000137-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000137-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 60</span>
 60:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">creategroup</span>
 61:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span>
 62:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
 63:     <span class="ruby-ivar">@student</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:uid</span>])
 64:     <span class="ruby-comment cmt"># Create new group for this assignment</span>
 65:     <span class="ruby-ivar">@grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">new</span>
 66:     <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">assignment</span> = <span class="ruby-ivar">@assignment</span>
 67:         <span class="ruby-comment cmt"># The student chose to work alone for this assignment.</span>
 68:     <span class="ruby-comment cmt"># He is then using his personnal repository. </span>
 69:     <span class="ruby-comment cmt"># The grouping he belongs to is then linked to a group which has the</span>
 70:     <span class="ruby-comment cmt"># student's username as groupname</span>
 71:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:workalone</span>]
 72:       <span class="ruby-comment cmt"># We therefore start by checking if the student's already have an</span>
 73:       <span class="ruby-comment cmt"># existing group</span>
 74:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:group_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">user_name</span>})
 75:         <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:group_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">user_name</span>})
 76:       <span class="ruby-keyword kw">else</span>
 77:         <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">new</span>
 78:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>)
 79:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_name</span> = <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">user_name</span>
 80:         <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>
 81:       <span class="ruby-keyword kw">end</span>
 82:     <span class="ruby-keyword kw">else</span>
 83:       <span class="ruby-identifier">group</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">new</span>
 84:       <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>)
 85:       <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_name</span> = <span class="ruby-value str">&quot;group_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
 86:       <span class="ruby-identifier">group</span>.<span class="ruby-identifier">save</span>
 87:     <span class="ruby-keyword kw">end</span>
 88:     <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">group</span> = <span class="ruby-identifier">group</span>
 89:     <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">save</span> 
 90:     <span class="ruby-comment cmt"># Set this user as inviter</span>
 91: 
 92:     <span class="ruby-comment cmt"># If the student is invited in an other group, we need to erase the</span>
 93:     <span class="ruby-comment cmt"># membership linked to the other group</span>
 94:     <span class="ruby-ivar">@membership</span> = <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">membership_for</span>(<span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>)
 95:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@membership</span>.<span class="ruby-identifier">nil?</span>
 96:       <span class="ruby-ivar">@membership</span>.<span class="ruby-identifier">delete</span>
 97:     <span class="ruby-keyword kw">end</span>
 98: 
 99:     <span class="ruby-comment cmt"># Creates a new membership</span>
100:     <span class="ruby-ivar">@member</span> = <span class="ruby-constant">StudentMembership</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:grouping_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:membership_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'inviter'</span>)
101:     <span class="ruby-ivar">@member</span>.<span class="ruby-identifier">save</span>
102:     
103:     <span class="ruby-comment cmt"># check if user is forming group on its own</span>
104:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group</span>][<span class="ruby-identifier">:single</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span>
105:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:members</span>]
106:         <span class="ruby-identifier">users</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:members</span>].<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>[<span class="ruby-value str">'user_name'</span>].<span class="ruby-identifier">strip</span>  }
107:         <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">invite</span>(<span class="ruby-identifier">users</span>)  <span class="ruby-comment cmt"># invite members to this group</span>
108:       <span class="ruby-keyword kw">end</span>
109:     <span class="ruby-keyword kw">end</span>
110:     <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">save</span>
111:     <span class="ruby-comment cmt"># display ajax response</span>
112:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
113:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'groups'</span>, 
114:           <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'student_interface'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
115:     <span class="ruby-keyword kw">end</span>
116:     
117:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000147" class="method-detail">
        <a name="M000147"></a>

        <div class="method-heading">
          <a href="#M000147" class="method-signature">
          <span class="method-name">csv_upload</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allows the user to upload a csv file listing groups.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000147-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000147-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 356</span>
356:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">csv_upload</span>
357:      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group</span>].<span class="ruby-identifier">blank?</span>
358:           <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
359: 
360:           <span class="ruby-identifier">num_update</span> = <span class="ruby-value">0</span>
361:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:invalid_lines</span>] = []  <span class="ruby-comment cmt"># store lines that were not processed</span>
362:         
363:         <span class="ruby-comment cmt"># Loop over each row, which lists the members to be added to the group.</span>
364:         <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group</span>][<span class="ruby-identifier">:grouplist</span>]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
365:                                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">add_csv_group</span>(<span class="ruby-identifier">row</span>, <span class="ruby-ivar">@assignment</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
366:                                                  <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:invalid_lines</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
367:                                         <span class="ruby-keyword kw">else</span>
368:                         <span class="ruby-identifier">num_update</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
369:                 <span class="ruby-keyword kw">end</span>
370:                    <span class="ruby-keyword kw">end</span>
371:                       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:upload_notice</span>] = <span class="ruby-node">&quot;#{num_update} group(s) added.&quot;</span>
372:      <span class="ruby-keyword kw">end</span>
373:      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'manage'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
374:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000140" class="method-detail">
        <a name="M000140"></a>

        <div class="method-heading">
          <a href="#M000140" class="method-signature">
          <span class="method-name">decline_invitation</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove rejected member
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000140-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000140-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 151</span>
151:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decline_invitation</span>
152:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
153:     <span class="ruby-ivar">@grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:grouping_id</span>])
154:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:uid</span>])
155:     <span class="ruby-identifier">membership</span> = <span class="ruby-constant">StudentMembership</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:grouping_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">id</span>})
156:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span>
157:     <span class="ruby-identifier">membership</span>.<span class="ruby-identifier">delete</span>
158:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
159:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'student_interface'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
160:     <span class="ruby-keyword kw">end</span> 
161:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000149" class="method-detail">
        <a name="M000149"></a>

        <div class="method-heading">
          <a href="#M000149" class="method-signature">
          <span class="method-name">download_grouplist</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000149-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000149-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 394</span>
394:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_grouplist</span>
395:     <span class="ruby-identifier">assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
396: 
397:     <span class="ruby-comment cmt">#get all the groups</span>
398:     <span class="ruby-identifier">groupings</span> = <span class="ruby-identifier">assignment</span>.<span class="ruby-identifier">groupings</span> <span class="ruby-comment cmt">#FIXME: optimize with eager loading</span>
399: 
400:     <span class="ruby-identifier">file_out</span> = <span class="ruby-constant">FasterCSV</span>.<span class="ruby-identifier">generate</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
401:        <span class="ruby-identifier">groupings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">grouping</span><span class="ruby-operator">|</span>
402:          <span class="ruby-identifier">group_array</span> = []
403:          <span class="ruby-comment cmt"># csv format is user1_name, user2_name, ... etc</span>
404:          <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">memberships</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:user</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">member</span><span class="ruby-operator">|</span>
405:             <span class="ruby-identifier">group_array</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">member</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>);
406:          <span class="ruby-keyword kw">end</span>
407:          <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">group_array</span>
408:        <span class="ruby-keyword kw">end</span>
409:      <span class="ruby-keyword kw">end</span>
410: 
411:     <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">file_out</span>, <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;text/csv&quot;</span>, <span class="ruby-identifier">:disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;inline&quot;</span>)
412:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
TODO filter (except <a href="GroupsController.html#M000135">index</a>) to
make sure assignment is a group assignment
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 19</span>
19:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
20:     <span class="ruby-ivar">@assignments</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>, 
21:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;group_max &gt; 1&quot;</span>]) <span class="ruby-comment cmt"># only group assignments</span>
22:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000138" class="method-detail">
        <a name="M000138"></a>

        <div class="method-heading">
          <a href="#M000138" class="method-signature">
          <span class="method-name">invite_member</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Invite members to group
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000138-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000138-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 122</span>
122:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">invite_member</span>
123:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span>)
124:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
125:     <span class="ruby-ivar">@student</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:uid</span>])
126:     <span class="ruby-ivar">@grouping</span> = <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">grouping_for</span>(<span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>)
127: 
128:     <span class="ruby-ivar">@invited</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:invite_member</span>])
129:     <span class="ruby-ivar">@invited</span>.<span class="ruby-identifier">invite</span>(<span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">id</span>)
130: 
131:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
132:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'student_interface'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span>
133:       <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
134:     <span class="ruby-keyword kw">end</span>
135:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000139" class="method-detail">
        <a name="M000139"></a>

        <div class="method-heading">
          <a href="#M000139" class="method-signature">
          <span class="method-name">join</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000139-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000139-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 137</span>
137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join</span>
138:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
139:     <span class="ruby-ivar">@grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:grouping_id</span>])
140:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:uid</span>])
141:     <span class="ruby-identifier">membership</span> = <span class="ruby-constant">StudentMembership</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:grouping_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">id</span>})
142:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span>
143:    <span class="ruby-identifier">membership</span>.<span class="ruby-identifier">membership_status</span> = <span class="ruby-value str">'accepted'</span> 
144:    <span class="ruby-identifier">membership</span>.<span class="ruby-identifier">save</span>
145:    <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
146:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'student_interface'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
147:    <span class="ruby-keyword kw">end</span>
148:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000146" class="method-detail">
        <a name="M000146"></a>

        <div class="method-heading">
          <a href="#M000146" class="method-signature">
          <span class="method-name">manage</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000146-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000146-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 347</span>
347:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">manage</span>
348:     <span class="ruby-ivar">@all_assignments</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:id</span>)
349:     <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])   
350:     <span class="ruby-ivar">@groupings</span> = <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">groupings</span> 
351:     <span class="ruby-comment cmt"># Returns a hash where s.id is the key, and student record is the value</span>
352:     <span class="ruby-ivar">@students</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">index_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span> }   
353:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000144" class="method-detail">
        <a name="M000144"></a>

        <div class="method-heading">
          <a href="#M000144" class="method-signature">
          <span class="method-name">remove_group</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000144-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000144-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 285</span>
285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_group</span>
286:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">delete?</span>
287:     <span class="ruby-comment cmt"># TODO remove groups for all assignment or just for the specific assignment?</span>
288:     <span class="ruby-comment cmt"># TODO remove submissions in file system?</span>
289:     <span class="ruby-identifier">grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:grouping_id</span>])  
290:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
291:       <span class="ruby-comment cmt"># update list of users not in group</span>
292:       <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">student_memberships</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:user</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">member</span><span class="ruby-operator">|</span>
293:         <span class="ruby-identifier">student</span> = <span class="ruby-identifier">member</span>.<span class="ruby-identifier">user</span>
294:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">insert_html</span> <span class="ruby-identifier">:bottom</span>, <span class="ruby-value str">&quot;student_list&quot;</span>,  
295:           <span class="ruby-node">&quot;&lt;li id='user_#{student.user_name}'&gt;#{student.user_name}&lt;/li&gt;&quot;</span>
296:         <span class="ruby-identifier">member</span>.<span class="ruby-identifier">destroy</span>
297:       <span class="ruby-keyword kw">end</span>
298:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">visual_effect</span>(<span class="ruby-identifier">:fade</span>, <span class="ruby-node">&quot;grouping_#{params[:grouping_id]}&quot;</span>, <span class="ruby-identifier">:duration</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span>)
299:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">0</span><span class="ruby-value">.5</span>) { <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-node">&quot;grouping_#{params[:grouping_id]}&quot;</span>  }
300:     <span class="ruby-keyword kw">end</span>
301:     <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">destroy</span>
302:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000142" class="method-detail">
        <a name="M000142"></a>

        <div class="method-heading">
          <a href="#M000142" class="method-signature">
          <span class="method-name">remove_member</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000142-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000142-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_member</span>
200:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">delete?</span>
201:     
202:     <span class="ruby-identifier">grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:grouping_id</span>])
203:     <span class="ruby-identifier">member</span> = <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">student_memberships</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mbr_id</span>])  <span class="ruby-comment cmt"># use group as scope</span>
204:     <span class="ruby-identifier">student</span> = <span class="ruby-identifier">member</span>.<span class="ruby-identifier">user</span>  <span class="ruby-comment cmt"># need to find user name to add to student list</span>
205:     
206:     <span class="ruby-identifier">inviter</span> = <span class="ruby-keyword kw">nil</span>  <span class="ruby-comment cmt"># new inviter if member being removed is an inviter</span>
207:     <span class="ruby-comment cmt"># randomly assign new inviter and rename submission file</span>
208:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">member</span>.<span class="ruby-identifier">inviter?</span>  <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">student_memberships</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
209:       <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
210:       <span class="ruby-comment cmt"># subm = @assignment.submission_by(student) #FIXME: make sure if submitter is removed, transfer </span>
211:       <span class="ruby-identifier">inviter</span> = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">student_memberships</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;created_at&quot;</span>, 
212:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;membership_status = 'accepted'&quot;</span>])
213:       <span class="ruby-comment cmt"># subm.owner = inviter.user  # assign new_inviter as submission owner</span>
214:       <span class="ruby-identifier">inviter</span>.<span class="ruby-identifier">membership_status</span> = <span class="ruby-value str">&quot;inviter&quot;</span>
215:       <span class="ruby-identifier">inviter</span>.<span class="ruby-identifier">save</span>
216:     <span class="ruby-keyword kw">end</span>
217:     
218:     <span class="ruby-identifier">member</span>.<span class="ruby-identifier">destroy</span>
219:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
220:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">visual_effect</span>(<span class="ruby-identifier">:fade</span>, <span class="ruby-node">&quot;mbr_#{params[:mbr_id]}&quot;</span>, <span class="ruby-identifier">:duration</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span>)
221:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-value">0</span><span class="ruby-value">.5</span>) { <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-node">&quot;mbr_#{params[:mbr_id]}&quot;</span> }
222:       <span class="ruby-comment cmt"># add members back to student list</span>
223:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">insert_html</span> <span class="ruby-identifier">:bottom</span>, <span class="ruby-value str">&quot;student_list&quot;</span>,  
224:         <span class="ruby-node">&quot;&lt;li id='user_#{student.user_name}'&gt;#{student.user_name}&lt;/li&gt;&quot;</span>
225:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">inviter</span>
226:         <span class="ruby-comment cmt"># replace the status of the new inviter to 'inviter'</span>
227:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-node">&quot;mbr_#{inviter.id}&quot;</span>
228:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">insert_html</span> <span class="ruby-identifier">:top</span>, <span class="ruby-node">&quot;group_#{group.id}_list&quot;</span>, 
229:           <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'groups/manage/member'</span>, <span class="ruby-identifier">:locals</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>, <span class="ruby-identifier">:member</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">inviter</span>}
230:       <span class="ruby-keyword kw">end</span>
231:     <span class="ruby-keyword kw">end</span>
232:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000145" class="method-detail">
        <a name="M000145"></a>

        <div class="method-heading">
          <a href="#M000145" class="method-signature">
          <span class="method-name">rename_group</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000145-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000145-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 304</span>
304:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename_group</span>
305:      <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
306:      <span class="ruby-ivar">@grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:grouping_id</span>]) 
307:      <span class="ruby-ivar">@group</span> = <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">group</span>
308: 
309:      <span class="ruby-comment cmt"># Checking if a group with this name already exists</span>
310: 
311:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@groups</span> = <span class="ruby-constant">Group</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:group_name</span> =<span class="ruby-operator">&gt;</span>
312:      [<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:new_groupname</span>]]})
313:          <span class="ruby-identifier">existing</span> = <span class="ruby-keyword kw">true</span>
314:          <span class="ruby-identifier">groupexist_id</span> = <span class="ruby-ivar">@groups</span>.<span class="ruby-identifier">id</span>
315:     <span class="ruby-keyword kw">end</span>
316:     
317:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">existing</span>
318:         <span class="ruby-comment cmt">#We update the group_name</span>
319:         <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">group_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:new_groupname</span>]
320:         <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">save</span>
321:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:edit_notice</span>] = <span class="ruby-value str">&quot;Group name has been updated&quot;</span>
322:      <span class="ruby-keyword kw">else</span>
323: 
324:         <span class="ruby-comment cmt"># We link the grouping to the group already existing</span>
325: 
326:         <span class="ruby-comment cmt"># We verify there is no other grouping linked to this group on the</span>
327:         <span class="ruby-comment cmt"># same assignement</span>
328:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:groupexist_id</span>] = <span class="ruby-identifier">groupexist_id</span>
329:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:assignment_id</span>] = <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
330: 
331:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;assignment_id =
332:         :assignment_id and group_id = :groupexist_id&quot;</span>, {<span class="ruby-identifier">:groupexist_id</span> =<span class="ruby-operator">&gt;</span>
333:         <span class="ruby-identifier">groupexist_id</span>, <span class="ruby-identifier">:assignment_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>}])
334:            <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:fail_notice</span>] = <span class="ruby-value str">&quot;This name is already used for this
335:            assignement&quot;</span>
336:         <span class="ruby-keyword kw">else</span>
337:           <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:group_id</span>, <span class="ruby-identifier">groupexist_id</span>)
338:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:edit_notice</span>] = <span class="ruby-value str">&quot;Group name has been changed&quot;</span>
339:         <span class="ruby-keyword kw">end</span>
340:      <span class="ruby-keyword kw">end</span>
341:      
342:      <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
343:        <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'manage'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>
344:      <span class="ruby-keyword kw">end</span>
345:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">student_interface</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 24</span>
24:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">student_interface</span>
25:      <span class="ruby-ivar">@assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
26:      <span class="ruby-ivar">@student</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:uid</span>])
27:      <span class="ruby-ivar">@grouping</span> = <span class="ruby-ivar">@student</span>.<span class="ruby-identifier">grouping_for</span>(<span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>)
28:      
29:      <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">nil?</span>
30:        <span class="ruby-ivar">@studentmemberships</span> = <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">student_memberships</span>
31:        <span class="ruby-ivar">@group</span> = <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">group</span>
32:        <span class="ruby-ivar">@inviter</span> = <span class="ruby-constant">StudentMembership</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:grouping_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@grouping</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:membership_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'inviter'</span>})
33:      <span class="ruby-keyword kw">end</span>
34: 
35:      <span class="ruby-comment cmt"># To list the students not in a group yet</span>
36:      <span class="ruby-comment cmt"># We make a list of all students</span>
37:      <span class="ruby-ivar">@students</span> = <span class="ruby-constant">Student</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">index_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span> }
38:      <span class="ruby-comment cmt"># We find all the groupings concerning this assignment</span>
39:      <span class="ruby-ivar">@groupings</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:assignment_id</span> =<span class="ruby-operator">&gt;</span>
40:      <span class="ruby-ivar">@assignment</span>.<span class="ruby-identifier">id</span>})
41:      <span class="ruby-comment cmt"># For each groupings, we list the memberships linked to this</span>
42:      <span class="ruby-comment cmt"># grouping. </span>
43:      <span class="ruby-ivar">@groupings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
44:      <span class="ruby-comment cmt"># If the status is inviter or accepted, then we erase this student</span>
45:      <span class="ruby-comment cmt"># from the list of students not part of a group.</span>
46:         <span class="ruby-ivar">@memberships</span> = <span class="ruby-constant">StudentMembership</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span>
47:      {<span class="ruby-identifier">:grouping_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:membership_status</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;inviter&quot;</span>,
48:      <span class="ruby-value str">&quot;accepted&quot;</span>]})
49:        <span class="ruby-comment cmt"># We check the existence of memberships</span>
50:        <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@memberships</span>.<span class="ruby-identifier">nil?</span>
51:          <span class="ruby-ivar">@memberships</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
52:            <span class="ruby-ivar">@students</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>)
53:          <span class="ruby-keyword kw">end</span>
54:        <span class="ruby-keyword kw">end</span>
55:     <span class="ruby-keyword kw">end</span>
56:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000150" class="method-detail">
        <a name="M000150"></a>

        <div class="method-heading">
          <a href="#M000150" class="method-signature">
          <span class="method-name">use_another_assignment_groups</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000150-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000150-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/groups_controller.rb, line 414</span>
414:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_another_assignment_groups</span>
415:     <span class="ruby-ivar">@target_assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
416:     <span class="ruby-identifier">source_assignment</span> = <span class="ruby-constant">Assignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clone_groups_assignment_id</span>])
417:       
418:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">nil?</span>
419:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:fail_notice</span>] = <span class="ruby-value str">&quot;Could not find source assignment for cloning groups&quot;</span>
420:     <span class="ruby-keyword kw">end</span>
421:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">nil?</span>
422:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:fail_notice</span>] = <span class="ruby-value str">&quot;Could not find target assignment for cloning groups&quot;</span>
423:     <span class="ruby-keyword kw">end</span>
424:       
425:     <span class="ruby-comment cmt"># First, destroy all groupings for the target assignment</span>
426:     <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">groupings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">grouping</span><span class="ruby-operator">|</span>
427:       <span class="ruby-identifier">grouping</span>.<span class="ruby-identifier">destroy</span>
428:     <span class="ruby-keyword kw">end</span>
429:       
430:     <span class="ruby-comment cmt"># Next, we need to set the target assignments grouping settings to match</span>
431:     <span class="ruby-comment cmt"># the source assignment</span>
432: 
433:     <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">group_min</span> = <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">group_min</span>
434:     <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">group_max</span> = <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">group_max</span>
435:     <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">student_form_groups</span> = <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">student_form_groups</span>
436:     <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">group_name_autogenerated</span> = <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">group_name_autogenerated</span>
437:     <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">group_name_displayed</span> = <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">group_name_displayed</span>
438:     
439:     <span class="ruby-identifier">source_groupings</span> = <span class="ruby-identifier">source_assignment</span>.<span class="ruby-identifier">groupings</span>
440: 
441:     <span class="ruby-identifier">source_groupings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">old_grouping</span><span class="ruby-operator">|</span>
442:       <span class="ruby-comment cmt">#create the groupings</span>
443:       <span class="ruby-identifier">new_grouping</span> = <span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">new</span>
444:       <span class="ruby-identifier">new_grouping</span>.<span class="ruby-identifier">assignment_id</span> = <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">id</span>
445:       <span class="ruby-identifier">new_grouping</span>.<span class="ruby-identifier">group_id</span> = <span class="ruby-identifier">old_grouping</span>.<span class="ruby-identifier">group_id</span>
446:       <span class="ruby-identifier">new_grouping</span>.<span class="ruby-identifier">save</span>
447:       <span class="ruby-comment cmt">#create the memberships - both TA and Student memberships</span>
448:       <span class="ruby-identifier">old_memberships</span> = <span class="ruby-identifier">old_grouping</span>.<span class="ruby-identifier">memberships</span>
449:       <span class="ruby-identifier">old_memberships</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">old_membership</span><span class="ruby-operator">|</span>
450:         <span class="ruby-identifier">new_membership</span> = <span class="ruby-constant">Membership</span>.<span class="ruby-identifier">new</span>
451:         <span class="ruby-identifier">new_membership</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">old_membership</span>.<span class="ruby-identifier">user_id</span>
452:         <span class="ruby-identifier">new_membership</span>.<span class="ruby-identifier">membership_status</span> = <span class="ruby-identifier">old_membership</span>.<span class="ruby-identifier">membership_status</span>
453:         <span class="ruby-identifier">new_membership</span>.<span class="ruby-identifier">grouping</span> = <span class="ruby-identifier">new_grouping</span>
454:         <span class="ruby-identifier">new_membership</span>.<span class="ruby-identifier">type</span> = <span class="ruby-identifier">old_membership</span>.<span class="ruby-identifier">type</span>
455:         <span class="ruby-identifier">new_membership</span>.<span class="ruby-identifier">save</span>
456:       <span class="ruby-keyword kw">end</span>
457:     <span class="ruby-keyword kw">end</span>
458: 
459:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:edit_notice</span>] = <span class="ruby-value str">&quot;Groups created&quot;</span>
460: 
461:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
462:         <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'manage'</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@target_assignment</span>.<span class="ruby-identifier">id</span>
463:     <span class="ruby-keyword kw">end</span>
464:   
465:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>