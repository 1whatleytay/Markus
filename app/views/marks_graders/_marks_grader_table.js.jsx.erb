<script type='text/jsx'>
  /** @jsx React.DOM */

  var GradersTable = React.createClass({
    getDefaultProps: function() {
      // Defines the columns used for the table and whether they
      // are sortable searchable. The default initially sorted
      // column is the first sortable column in the array.
      return {
        columns: [
          {
            id: 'user_name',
            content: '<%= j raw I18n.t(:'user.user_name') %>',
            sortable: true,
            searchable: true
          },
          {
            id: 'full_name',
            content: '<%= j raw I18n.t(:'user.full_name') %>',
            sortable: true,
            searchable: true
          },
          {
            id: 'students',
            content: '<%= j raw I18n.t(:'students.students') %>',
            sortable: true,
            searchable: true
          }
        ]
      }
    },
    getInitialState: function() {
      return {
        error: null,
        graders: [],
        selected_graders: []
      };
    },
    updateSelectedGraders: function(graders) {
      this.setState({selected_graders:graders});
    },
    componentWillMount: function() {
      this.refresh();
    },
    // Asks for new info from backend and sets props accordingly.
    refresh: function() {
      document.getElementById('working').style.display = '';

      jQuery.ajax({
        url: '/en/grade_entry_forms/1/marks_graders/populate_graders_table',
        method: 'POST',
        dataType: 'json',
        success: function(data) {
          this.setState({
            graders: data,
            error: null
          });
        }.bind(this),
        error: function(xhr, status, text) {
          var error = text + ': ' + xhr.responseText;
          this.setState({
            error: error
          });
        },
        complete: function() {
          document.getElementById('working').style.display = 'none';
        }

      });
    },
    onError: function(error) {
      this.setState({
        error: error
      });
    },
    render: function() {
      // Do student-specific table stuff here.
      var graders_data = this.state.graders.map(function(grader) {
        var g = {};
        g['id'] = grader.id;
        g['checkbox'] = <input id={'grader_select_' + grader.id} type='checkbox'
          name='graders[]' value={grader.id}
          checked={this.state.selected_graders.indexOf(grader.id) !== -1}
          onChange={this.checkboxClicked} />
        g['user_name'] = grader.user_name;
        g['full_name'] = grader.first_name + " " + grader.last_name;
        g['students'] = grader.num_students;
        return g;
      }.bind(this));

      return (
        <div>
          <ErrorDiv error={this.state.error} />

          <Table data={graders_data}
            search_placeholder={'<%= j raw I18n.t(:'search_graders') %>'}
            selectable={true}
            onSelectedRowsChange={this.updateSelectedGraders}
            columns={this.props.columns}
            filters={this.props.filters} />
        </div>
      );
    }
  });

  React.renderComponent(<GradersTable sections={<%= raw @sections.to_json %>} />, document.getElementById('graders_table'));
</script>
