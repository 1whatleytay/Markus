<h1><%=h @title %></h1>

<p>

<% form_for :assignment, :url => {:action => action, :id => @assignment.id } do |f| -%>

<fieldset>

  <legend>Assignment Properties</legend>

  <%= error_messages_for :assignment, :assignment_files, :object => @assignment.submission_rule %>
  
    <%= f.label :name  %>
    <%= f.text_field :name %><br />

    <%= f.label :description %>
    <%= f.text_field :description %><br />
    
    <%= f.label :message %>
    <%= f.text_area :message, :rows => 5, :col => 45 %><br />
    
    <%= f.label "Due Date:"%>
    <%= f.datetime_select "due_date", :default => 3.hours.from_now %>



  <h4>Add filename(s) that students would be required to submit:</h4>
  <%# render the link instead of embedding, to dynamically update 
        the index of the next file text field -%>
  <%= render :partial => 'add_file_link', 
    :locals => { :index => @assignment.assignment_files.size } %>
  
    <p id="files">
    <% @assignment.assignment_files.each do |file| -%>
      <%= render :partial => 'file_fields', :locals => { :assignment_file => file} -%>
    <% end -%> 
  </p>

</fieldset>

<fieldset>
  <legend>Group Properties</legend>
<% if action == 'create' %>
<div id="group_properties" style = "display: none;">
<p>
    Group Limit (must be 1 or more):
    from <%= f.text_field :group_min, :size => 5, :maxlength => 3 %>
    to <%= f.text_field :group_max, :size => 5, :maxlength => 3 %>
    people in a group.
  </p>

  <p>
    Allow students to form their own groups
    <%= f.check_box :student_form_groups %>
  </p>

  <p>
    Group's names autogenerated:
    <%= f.check_box :group_name_autogenerated%>
  </p>

  <p>
    Group's names displayed to students:
    <%= f.check_box :group_name_displayed %>
  </p>
   <p>
    <%= link_to_remote 'cancel', :url => {:action => 'cancel'}%>
   </p>
</div>


   <div id="other_assignment_groups" style="display: none;">
<p>
     Assignment's groups to use: 
     <%= text_field_with_auto_complete :assignment, :name, :id =>
'assignment_name_group', :name => 'assignment_name_group' %>
</p>
<p>
<%= link_to_remote 'cancel', :url => {:action => 'cancel'}%>
</p>
   </div>


<div id="group_choice">
     <%=  link_to_remote 'Use another assignment\'s groups', :url =>
     {:action => 'use_another_assignment_groups'} %><br />

     <%=  link_to_remote 'New group properties', :url => {:action => 'new_group_properties'}-%>
<% else %> 
<div id="group_properties">
<p>
    Group Limit (must be 1 or more):
    from <%= f.text_field :group_min, :size => 5, :maxlength => 3 %>
    to <%= f.text_field :group_max, :size => 5, :maxlength => 3 %>
    people in a group.
  </p>

  <p>
    Allow students to form their own groups
    <%= f.check_box :student_form_groups %>
  </p>

  <p>
    Group's names autogenerated:
    <%= f.check_box :group_name_autogenerated%>
  </p>

  <p>
    Group's names displayed to students:
    <%= f.check_box :group_name_displayed %>
  </p>
</div>


<% end %>



</fieldset>

<fieldset>
  <legend>Submission Rules</legend>

  <%- fields_for :submission_rule, @assignment.submission_rule do |rule| -%>
    <p>
      Allow students to submit 
      <%= rule.text_field :allow_submit_until, :size => 3 %> 
      hours after deadline
    </p>

    <h5>Choose penalty rules to apply for late submissions:</h5>

    <p>
      <%= rule.radio_button :type, "NullSubmissionRule" %>
      No penalty for late submissions
    </p>

    <p>
      <%= rule.radio_button :type, "GraceDaySubmissionRule" %>
      Automatically deduct grace days
    </p>

    <p>
      Allow students to use up to 
      <%= rule.text_field :grace_day_limit, :size => 3 %> 
      grace days for this assignment.
    </p>
  
    <p>
      <%= rule.radio_button :type, "PenaltySubmissionRule" %>
      Use Penalty Formula
    </p>

    <p>
      Deduct at most <%= rule.text_field :penalty_limit, :size => 3 %> points 
      in increments of <%= rule.text_field :penalty_increment, :size => 3 %> for every 
      <%= rule.text_field :penalty_interval, :size => 3 %>
      <%= rule.select :penalty_interval_unit, ["days", "hours", "minutes"] %>
      late.
    </p>
  <%- end -%>
</fieldset>

  <p><%= f.submit @submit_text, :name => action %></p>
  
<% end %>

<%= link_to 'Cancel', :action => 'index' %>
</div>
