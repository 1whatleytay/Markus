<%= javascript_include_tag "create_assignment.js" %>

<div id="title_bar"><h1>Create a New Assignment</h1>
</div>

<p>
<% form_for :assignment, :url => {:action => 'new'} do |f| -%>
<%= f.error_messages %>
<fieldset>

  <legend>Assignment Properties</legend>
 
    <%= f.label :name, "Short Identifier" %>
    <%= f.text_field :name, :onchange =>  "$('assignment_repository_folder').setValue($(this).getValue())"%><br />

    <%= f.label :description, "Title" %>
    <%= f.text_field :description %><br />
    
    <%= f.label :message %>
    <%= f.text_area :message, :rows => 5, :col => 45 %><br />
    
    <%= f.label "Due Date:"%>
    <%= f.datetime_select "due_date"%>
     
</fieldset>

<fieldset>
  <legend>Submitted Files</legend>
    <%= f.label :repository_folder, "Repository Folder"%>
    /<%= f.text_field :repository_folder%>
  <h4>Add filename(s) that students would be required to submit:</h4>
   <p id="assignment_files">
   </p>
   <p id="assignment_file_add_link">
     <%= link_to_function "Add a Required File", "add_assignment_file();" %>
   </p>
</fieldset>

<fieldset>
  <legend>Assignment Type</legend>
  <p>
  <%= check_box_tag "is_group_assignment", true, false, :id => "is_group_assignment", :onchange => "toggle_group_assignment($F('is_group_assignment'))"%>
    Students can work in groups
  </p>
 <p <%='style="display:none;"' unless @assignments.size > 0 %>>
   <%= check_box_tag "persist_groups", true, false, :id => "persist_groups", :onclick => "toggle_persist_groups($(this).getValue());", :disabled => true%>
  Persist Groups / Properties from 
  <select id="persist_groups_assignment" name="persist_groups_assignment" onChange="<%= remote_function(:url => {:action => "update_group_properties_on_persist"}, :with => "'assignment_id=' + $F('persist_groups_assignment')")%>" disabled>
    <% @assignments.each do |assignment| %>
    <option value="<%= h(assignment.id) %>"><%= h(assignment.name)%></option>
    <% end %>
  </select>
 </p>
  <fieldset>
    <legend>Group Properties</legend>
    <div id="group_properties" class="disabled">
  <p>
    Allow students to form their own groups
    <%= check_box_tag "students_form_groups", true, false, :id => "students_form_groups", :disabled => true, :onchange => "toggle_students_form_groups($F('students_form_groups'))"%>
  </p>

  <p>
    Group Limit (must be 1 or more):
    from <%= f.text_field :group_min, :size => 5, :maxlength => 3, :disabled => true%>
    to <%= f.text_field :group_max, :size => 5, :maxlength => 3, :disabled => true %>
    people in a group.
  </p>


  <p>
    Group's names autogenerated:
    <%= f.check_box :group_name_autogenerated, :checked => true, :disabled => true%>
  </p>
</div>
  </fieldset>
</fieldset>

<fieldset>
  <legend>Submission Rules</legend>

  <%- fields_for :submission_rule do |rule| -%>
    <p>
      Allow students to submit 
      <%= rule.text_field :allow_submit_until, :size => 3, :value => "0" %> 
      hours after deadline
    </p>

    <h5>Choose penalty rules to apply for late submissions:</h5>

    <p>
      <%= rule.radio_button :type, "NullSubmissionRule", :checked => true %>
      No penalty for late submissions
    </p>

    <p>
      <%= rule.radio_button :type, "GraceDaySubmissionRule" %>
      Automatically deduct grace days
    </p>

    <p>
      Allow students to use up to 
      <%= rule.text_field :grace_day_limit, :size => 3 %> 
      grace days for this assignment.
    </p>
  
    <p>
      <%= rule.radio_button :type, "PenaltySubmissionRule" %>
      Use Penalty Formula
    </p>

    <p>
      Deduct at most <%= rule.text_field :penalty_limit, :size => 3 %> points 
      in increments of <%= rule.text_field :penalty_increment, :size => 3 %> for every 
      <%= rule.text_field :penalty_interval, :size => 3 %>
      <%= rule.select :penalty_interval_unit, ["days", "hours", "minutes"] %>
      late.
    </p>
  <%- end -%>
  

</fieldset>  

<%= f.submit "Create Assignment" %>
<% end %>

</div>
