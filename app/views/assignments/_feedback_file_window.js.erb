<script>
  $(document).ready(function() {
    $('#select_feedback_file_id').change();
  });

  function load_feedback_file(feedback_file_id) {
    if (feedback_file_id === '') {
      return;
    }
    $('#select_feedback_file_id').prop('disabled', true);
    $.ajax({
      url: '<%= render_feedback_file_assignment_path(id: @assignment.id) %>',
      type: 'GET',
      data: {feedback_file_id: feedback_file_id},
      dataType: 'text',
      beforeSend: function() {
        document.getElementById('working').style.display = '';
      },
      complete: function() {
        document.getElementById('working').style.display = 'none';
      },
      success: function (data, textStatus, jqXHR) {
        var contentType = jqXHR.getResponseHeader('Content-Type');

        if (contentType.startsWith('image')) {
          $('#feedback_file_content').html(
          '<img src="data:' + contentType + ';base64,' + data + '" style="max-width: 70%"/>');
        } else {
          var pars = data.split('\n').map(function(line) {
            return $('<p></p>').text(line);
          });
          $('#feedback_file_content').empty().append(pars);
        }
      },
      error: function () {
        $('#feedback_file_content').html('Error retrieving feedback file');
      }
    });
    $('#select_feedback_file_id').prop('disabled', false);
  }
</script>
