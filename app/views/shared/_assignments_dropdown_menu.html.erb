<% if @current_user.admin? %>
  <li class="level2">
    <%= link_to I18n.t(:create_new), :controller => 'assignments', :action => 'new' %>
  </li>
<% end %>

<% Assignment.all.each do |assignment|%>
  <% if assignment != @assignment %>
    <% if (controller.controller_name == "assignments" &&
          (controller.action_name == "index" or 
          controller.action_name == 'new')) ||
          controller.controller_name == "results" %>
      <% if @current_user.student? %>
        <li class="level2">
          <%= link_to h(assignment.short_identifier), :controller => 'assignments', :action => 'student_interface', :id => assignment.id %>
        </li>
      <% elsif @current_user.ta? %>
        <li class="level2">
          <%= link_to h(assignment.short_identifier), :controller => 'submissions', :action => 'browse', :id => assignment.id %>
		</li>
      <% else %>
        <li class="level2">
          <%= link_to h(assignment.short_identifier), :controller => 'assignments', :action => "edit", :id => assignment.id %>
		</li>
      <% end %>
    <% else %>
      <li class="level2">
      	<% # If the current controller is rubrics or flexible_criteria, we have to choose
           # the appropritate controller according to the selected assignment's marking scheme type. 
           if controller.controller_name == 'rubrics' || controller.controller_name == 'flexible_criteria'
		     if assignment.marking_scheme_type == Assignment::MARKING_SCHEME_TYPE[:rubric]
               target_controller = 'rubrics'
             else
               target_controller = 'flexible_criteria'
             end
           else
             target_controller = controller.controller_name
           end %>
		<%= link_to h(assignment.short_identifier), :controller => target_controller, :action => controller.action_name, :id => assignment.id %>
      </li>
    <% end %>
  <% end %>
<% end %>

