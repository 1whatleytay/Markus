<% if marker %>
  <div id='<%="mark_criterion_title_#{mark_criterion.id}_expand"%>'
       class='criterion_expand' >
    - &nbsp;
  </div>
<% end %>

<strong class="title_div_level">
  <%= link_to mark_criterion.name,
              'javascript:void(0);',
              onclick: 'return false;',
              class: 'criterion_link' %>
</strong>

<div id="<%="mark_criterion_title_#{mark.id}_mark"%>"
     class='criterion_description'
     data-id='<%= mark_criterion.id %>'>
</div>

<div class='clear'></div>

<% container_class = marker ? 'mark_criterion_level_container' : 'mark_criterion_level_released_container' %>
<div id='<%="criterion_info_#{mark_criterion.id}"%>'>
  <div class=<%= container_class %> data-id='<%= mark_criterion.id %>'
       criterion-class='<%= mark_criterion.class.to_s %>'>
    <div class='cursor_hand'>
      <table id='mark_<%= mark.id %>_table'>
        <%
          (0...RubricCriterion::RUBRIC_LEVELS).each do |num_levels|
            if (!old_mark.nil? && num_levels == (old_mark.mark.nil? ? old_mark.mark : old_mark.mark / mark_criterion.weight))
              td_class = 'rubric_criterion_level_old_mark'
            elsif (num_levels == (mark.mark.nil? ? mark.mark : mark.mark / mark_criterion.weight))
              td_class = 'rubric_criterion_level_selected'
            elsif marker
              td_class = 'rubric_criterion_level'
            end

            level_name = mark_criterion['level_' + num_levels.to_s + '_name']
            level_desc = mark_criterion['level_' + num_levels.to_s + '_description']

            if marker
              if level_desc && !level_desc.empty? -%>
                  <tr>
                    <td id='mark_<%= mark.id%>_<%=num_levels %>' class='<%=td_class%>'
                        data-action='
                          <%= update_mark_assignment_submission_results_path(mark_id: mark.id, mark: num_levels, id: result.id) %>'
                        onclick='update_rubric_mark(this, <%= mark.id %>, <%= num_levels %>)'
                        data-id='<%= mark_criterion.id %>' >
                      <div class='description'>
                        <strong> <%= level_name %></strong>
                        &nbsp;<%=level_desc%>
                      </div>
                      <div class='mark'><%=num_levels%></div>
                    </td>
                  </tr>
              <% end -%>
            <% elsif level_desc && !level_desc.empty? && (td_class == "rubric_criterion_level_old_mark" ||
              td_class == "rubric_criterion_level_selected") -%>
              <tr>
                <td id="mark_<%= mark.id %>_<%= num_levels %>" class="<%= td_class %>">
                  <div class='description'>
                    <strong> <%= level_name %></strong>
                    &nbsp;<%=level_desc%>
                  </div>
                  <div class='mark'><%= num_levels %></div>
                </td>
              </tr>
            <% end -%>
        <% end -%>
      </table>
    </div>
  </div>
</div>
