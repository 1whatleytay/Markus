$criteria_list = $('#mark_criteria_pane_list>li:not(.unassigned)');

Mousetrap.bind('shift+,', function(){
  $('#student_selector>.left>a')[0].click();
});
Mousetrap.bind('shift+.', function(){
  $('#student_selector>.right>a')[0].click();
});
Mousetrap.bind('tab', function(e){
  if($('.active-criteria').length){
    $next_criteria = $('.active-criteria').next('li:not(.unassigned)');
  }else{
    $next_criteria = $criteria_list.first();
  }
  activeCriteria($next_criteria);
  return false;
});
Mousetrap.bind('shift+tab', function(e){
    activeCriteria($criteria_list.first());
    return false;
});
// Mousetrap is incapable of capturing a TAB event while focused on an input field
$('body').on('keydown', '.mark_grade_input, .mark_grade_input_checkbox', function(e) {
    if (e.which == 9) {
        e.preventDefault();
        Mousetrap.trigger('tab');
    }
});
Mousetrap.bind('up', function(e){
  $current_criteria = $('.active-criteria');
  if($current_criteria.length && !$current_criteria.hasClass('unassigned')){
      if($current_criteria.hasClass('rubric_criterion')){
          e.preventDefault();
          $selected = $('.active-rubric');
          if($selected.length){
              $next = $selected.parent().prev();
              if(!$next.length){
                  $next = $selected.parent().siblings().last();
              }
              $selected.removeClass('active-rubric');
              $next.children().addClass('active-rubric');
          }
          return false;
      }
  }
});
Mousetrap.bind('down', function(e){
    $current_criteria = $('.active-criteria');
    if($current_criteria.length && !$current_criteria.hasClass('unassigned')){
        if($current_criteria.hasClass('rubric_criterion')){
            e.preventDefault();
            $selected = $('.active-rubric');
            if($selected.length){
                $next = $selected.parent().next();
                if(!$next.length){
                    $next = $selected.parent().siblings().first();
                }
                $selected.removeClass('active-rubric');
                $next.children().addClass('active-rubric');
            }
            return false;
        }
    }
});
Mousetrap.bind('enter', function (e) {
    if($('.active-rubric').length){
        e.preventDefault();
        $('.active-rubric').trigger('onclick');
    }
})
