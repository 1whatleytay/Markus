<%=javascript_include_tag "file_manager"%>
<%= javascript_include_tag "FilterTable/FilterTable.js" %>

<%= render :partial => "file_manager_boot.js.erb" %>

<div id="title_bar">
<h1><%= h(sanitize(@assignment.name)) %>: File Manager</h1>
</div>

<div class="wrapLeft">
  <% if flash[:submit_notice] -%>   
     <p class="success"><%= h(flash[:submit_notice]) %> </p>
  <% end %>

<div id="directory_selector" <%='style="display:none;"' unless @directories.length > 0 %>>
<%= form_tag({:action => 'file_manager'}, :method => :get) %>
<select id="path" name="path" onchange="$(this).form.submit();">
    <option>/</option>
<% @directories.each do |directory_name, directory| %>
    <option><%= h(directory_name) %></option>
<% end %>
</select>
</form>
</div>


<% if flash[:transaction_warning] %>
  <div class="warning"><%= flash[:transaction_warning] %></div>
<% end %>

<% if @assignment.submission_rule.can_collect_now? %>
  <div class="notice">
    <%= h(@assignment.submission_rule.after_collection_message(@grouping)) %>
  </div>
<% else %>
  <% if @assignment.due_date < Time.now %>
    <div class="notice">
      <%= h(@assignment.submission_rule.overtime_message(@grouping)) %>
    </div>
  <% end %>
<% end %>

<% if flash[:update_conflicts] %>
  <div class="error">
    <h2>Conflicts</h2>
    <p>Your changes have not been made.  The following file conflicts were detected:</p>
    <ul>
    <% flash[:update_conflicts].each do |conflict| %>
      <li><%= h(conflict.to_s) %></li>
    <% end %>
    </ul>
  </div>
<% end %>
<% if !@grouping.is_valid? %>
<div class="error">
  Your group is currently invalid.  You probably haven't met the group size minimum.  You will not be able to submit anything until you have met this minimum.
</div>
<% elsif @missing_assignment_files.size > 0 %>
  <div class="warning">
  <p>You still need to submit <%=@missing_assignment_files.size%> required file(s) for this assignment:
  <% if @missing_assignment_files.size > 5 %>
    <%= link_to_function "click here to toggle the list of missing files.", "$('missing_assignment_files_list').toggle();"%>
  <% end %>
  </p>
  <ul id="missing_assignment_files_list" <%='style="display:none;"' if @missing_assignment_files.size > 5%>
  <% @missing_assignment_files.each do |assignment_file| %>
    <li><%= h(assignment_file.filename) %></li>
  <% end %>
  </ul>
 </div>
<% end %>
<% if flash[:commit_notice] %>
  <div class="notice">
    <%=flash[:commit_notice]%>
  </div>
<% end %>
<% if flash[:commit_error] %>
  <div class="warning">
    <%=flash[:commit_error] %>
  </div>
<% end %>

<%= form_tag( {:action => "update_files", :id => @assignment.id}, {:multipart => true, :id => 'submit_form'} ) unless !@grouping.is_valid? %>
<% if @grouping.is_valid? %>
<div class="global_action_left" >
  <%=button_to_function "Add A New File", "injectFileInput();"%>
</div>
<% end %>

<div class="global_action">
<span id="loading_list"><%= image_tag("spinner.gif") %> Loading list...
</span>
<% if @grouping.is_valid? %>
<%= submit_tag I18n.t(:submit), :disabled => !@grouping.is_valid? %>
<%= link_to I18n.t(:cancel), {:controller => 'submissions', :action =>
'file_manager'}, :id => @assignment.id, :disabled => !@grouping.is_valid?,
:class => "button", :confirm => "Are you sure you want to discard your changes?" %>
<% end %>
</div>

<div class="clear"></div>

  <table class="files" id="files">
  </table>

<% if @grouping.is_valid? %>
<div class="global_action">
<%= submit_tag I18n.t(:submit), :disabled => !@grouping.is_valid? %>
<%= link_to I18n.t(:cancel), {:controller => 'submissions', :action =>
'file_manager'}, :id => @assignment.id, :disabled => !@grouping.is_valid?,
:class => "button" %>
</div>
</form>
<% end %>

</div>

