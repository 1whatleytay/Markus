<% content_for :head do %>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      makeTestScriptResultTable(document.getElementById('test_script_result_table'), {
        result_id: <%= @result&.id || 'null' %>,
        submission_id: <%= @result&.submission_id || 'null' %>,
        assignment_id: <%= @assignment.id %>,
        grouping_id: <%= @grouping.id %>,
        instructor_run: <%= ran_by == 'instructor' %>,
        instructor_view: <%= !@current_user.student? %>
      });
    })
  </script>
<% end %>

<h2 class="test_runs_header">
  <% authorized, reason = AutomatedTestsClientHelper.allowed_to?(@current_user, assignment: @assignment,
                                                                 submission: @result&.submission,
                                                                 grouping: @grouping) %>
  <% route = @current_user.admin? ?
               run_tests_assignment_submission_result_path :
               execute_test_run_automated_test_path(id: @assignment.id, grouping_id: @grouping.id) %>
  <% unless authorized %>
    <% flash_now(:notice, reason) %>
  <% end %>
  <% if @current_user.student? %>
    <%= t('automated_tests.test_results') %>
  <% end %>
  <%= button_to t('automated_tests.run_tests'), route, disabled: !authorized %>
</h2>
<div class="block_content">
  <div id='test_script_result_table'></div>
</div>
