<%= javascript_include_tag "students_manager"%>
<h1>Manage Students</h1>

<div id="sub_menu">
   <ul>
      <li><a href="#list">View Student List | </a></li>
      <li><a href="#register">Register Students</a></li>
   </ul>
</div>

<div class="colsLeftHeavy">

  <div><div class="wrapLeft">
    <div id="list">
    <h2>View Student List (<%= link_to "XML", :action => 'download_student_list', :format => 'xml' %>)</h2>
    
      <% if flash[:upload_notice] -%>
          <p class="success"><%= h(flash[:upload_notice]) %></p>
      <% end -%>
      
      <% if flash[:edit_notice] -%>
        <p style="color:green"><%= h(flash[:edit_notice]) %></p>
      <% end -%>
      
      <% # display lines in csv file that has not been successfully processed %>
      <% if flash[:invalid_lines] && !flash[:invalid_lines].empty? -%>
      <div class="errorExplanation" id="errorExplanation">
        <p>The following Students have not been successfully added:</p>
        <ul>
          <% for line in flash[:invalid_lines] -%>
          <li><%= h(line) %></li>
          <% end -%>
        </ul>
        <p>Make sure that:</p>
        <ul>
          <li>Student names are alphanumeric</li>
          <li>Each field is separated by a comma (no spaces)</li>
          <li>Each line has the required fields specified above</li>
        </ul>
      </div>
      <% end -%>
      
      <%= form_remote_tag :url => {:action => "bulk_modify"}, :complete => "$('apply_bulk_action').setValue('Apply Bulk Action');$('apply_bulk_action').enable();"
       %>
      <select name="bulk_action">
        <option value="">Select bulk action</option>
        <option value="hide">Hide Selected Students</option>
        <option value="unhide">Unhide Selected Students</option>
      </select>
      <%= submit_tag "Apply Bulk Action", :id => 'apply_bulk_action', :onclick => "$(this).setValue('Processing...'); $(this).disable();" %>
      
      <input type="checkbox" id="show_hidden_students" name="show_hidden_students" value="true" onclick="if($(this).getValue() == 'true') { $$('.hidden_student').each(function(node) { $(node).show();}) } else { $$('.hidden_student').each(function(node) { $(node).hide();}) }"> Show Hidden Students (<span id="hidden_students_number"><%=@hidden_students_number%></span>)

      <table>
        
       <tr>
       	  <%
	   # pull "labels" from I18n files
	  %>
	  <th></th>
          <th><%= I18n.t('user.user_name') %></th>
          <th><%= I18n.t('user.last_name') %></th>
          <th><%= I18n.t('user.first_name') %></th>
          <th></th>
        </tr>
          
        <% for u in @students %>
          <tr class="<%= cycle('rowA', 'rowB') %> <%="hidden_student" if u.hidden%>" id="student_<%=u.id%>">
            <td><%= check_box_tag 'student_ids[]', u.id, false, :id => "student_#{u.id}_checkbox"%></td>
            <td><%= h(u.user_name) %></td>
            <td><%= h(u.last_name) %></td>
            <td><%= h(u.first_name) %></td>
            <td><%= link_to 'Edit', :controller => 'students', :action => 'edit', :id => u %></td>
          </tr>
        <% end %>
        
      </table>
      </form>
  </div>
  </div>
  
<div id="register">
  <h2>Register Students</h2>
  
  
    <h3>Upload a class list</h3>
    
    <div class="section">
      
      <p>Select a CSV file of the following form: <code>user_name,last_name,first_name</code></p>
      
      <p>If a student with the same student number exists, then the student's information is updated.</p>
      
      <%= form_tag( { :controller => "students", :action => "upload_student_list" }, { :multipart => true }) %>
        <label for="userlist">CVS File</label>
        <input type="file" name="userlist" id="userlist"/>
        <%= submit_tag "Update userlist", :disable_with => 'Processing...', :class => 'button' %>
      </form>
    
    </div>
    
    <h3>Add Each Student Individually</h3>
    
    <div class="section">
      <p><%= link_to "Add a new Student", :controller => 'students', :action => 'create' %></p>
    </div>

    <h3>Download Student List</h3>

    <div class="section">
      <p><%= link_to "Download Student list in CSV format", :controller => 'students', :action => 'download_student_list', :format => "csv" %></p>
    </div>
</div>
  </div>

</div> <!-- colsLeftHeavy -->
