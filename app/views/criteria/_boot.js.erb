<script>
  jQuery(document).ready(function() {
    modal_upload   = jQuery('#upload_dialog').easyModal();
    modal_download = jQuery('#download_dialog').easyModal();
    jQuery('#uploadModal').on('click',function(){
      modal_upload.trigger('openModal');
    });
    jQuery('#downloadModal').on('click',function(){
      modal_download.trigger('openModal');
    });
    bindSortable();

    var ajaxRequest;
    function bindSortable() {
      jQuery('.sortable ul').sortable({
        axis:   'y',
        cursor: 'move',
        update: function() {
          // Cancel any previous requests
          if (typeof ajaxRequest !== 'undefined') {
            ajaxRequest.abort();
          }

          ajaxRequest = jQuery.ajax({
            url:  '<%= update_positions_assignment_criteria_path(@assignment) %>',
            type: 'POST',
            data: jQuery('.sortable ul').sortable('serialize'),
            dataType: 'script',
            success: function(response) {
              ajaxRequest = undefined;
              bindSortable();
            }
          });
        },
        cancel: '#new_criterion'
      });
    }
  });
</script>
