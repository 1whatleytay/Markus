# encoding: UTF-8
# This file is auto-generated from the current state of the database. Instead
# of editing this file, please use the migrations feature of Active Record to
# incrementally modify your database, and then regenerate this schema definition.
#
# Note that this schema.rb definition is the authoritative source for your
# database schema. If you need to create the application database on another
# system, you should be using db:schema:load, not running all the migrations
# from scratch. The latter is a flawed and unsustainable approach (the more migrations
# you'll amass, the slower it'll run and the greater likelihood for issues).
#
# It's strongly recommended that you check this file into your version control system.

ActiveRecord::Schema.define(version: 20151114204502) do

  create_table "annotation_categories", force: :cascade do |t|
    t.text     "annotation_category_name", limit: 65535
    t.integer  "position",                 limit: 4
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "assignment_id",            limit: 4,     null: false
  end

  add_index "annotation_categories", ["assignment_id"], name: "index_annotation_categories_on_assignment_id", using: :btree

  create_table "annotation_texts", force: :cascade do |t|
    t.text     "content",                limit: 65535
    t.integer  "annotation_category_id", limit: 4
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "creator_id",             limit: 4
    t.integer  "last_editor_id",         limit: 4
  end

  add_index "annotation_texts", ["annotation_category_id"], name: "index_annotation_texts_on_annotation_category_id", using: :btree

  create_table "annotations", force: :cascade do |t|
    t.integer "line_start",         limit: 4
    t.integer "line_end",           limit: 4
    t.integer "annotation_text_id", limit: 4
    t.integer "submission_file_id", limit: 4
    t.integer "x1",                 limit: 4
    t.integer "x2",                 limit: 4
    t.integer "y1",                 limit: 4
    t.integer "y2",                 limit: 4
    t.string  "type",               limit: 255
    t.integer "annotation_number",  limit: 4
    t.boolean "is_remark"
    t.integer "page",               limit: 4
    t.integer "column_start",       limit: 4
    t.integer "column_end",         limit: 4
  end

  add_index "annotations", ["annotation_text_id"], name: "fk_annotations_annotation_texts", using: :btree
  add_index "annotations", ["submission_file_id"], name: "index_annotations_on_submission_file_id", using: :btree

  create_table "assignment_files", force: :cascade do |t|
    t.integer  "assignment_id", limit: 4
    t.string   "filename",      limit: 255, null: false
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  add_index "assignment_files", ["assignment_id", "filename"], name: "index_assignment_files_on_assignment_id_and_filename", unique: true, using: :btree
  add_index "assignment_files", ["assignment_id"], name: "index_assignment_files_on_assignment_id", using: :btree

  create_table "assignment_stats", force: :cascade do |t|
    t.integer "assignment_id",                 limit: 4
    t.text    "grade_distribution_percentage", limit: 65535
  end

  add_index "assignment_stats", ["assignment_id"], name: "fk_assignment_stats_assignments", using: :btree

  create_table "assignments", force: :cascade do |t|
    t.string   "short_identifier",                 limit: 255,                      null: false
    t.string   "description",                      limit: 255
    t.text     "message",                          limit: 65535
    t.datetime "due_date"
    t.integer  "group_min",                        limit: 4,     default: 1,        null: false
    t.integer  "group_max",                        limit: 4,     default: 1,        null: false
    t.datetime "created_at"
    t.datetime "updated_at"
    t.boolean  "student_form_groups"
    t.boolean  "group_name_autogenerated"
    t.boolean  "group_name_displayed"
    t.string   "repository_folder",                limit: 255,                      null: false
    t.boolean  "invalid_override"
    t.float    "results_average",                  limit: 24
    t.string   "marking_scheme_type",              limit: 255,   default: "rubric"
    t.boolean  "allow_web_submits",                              default: true
    t.boolean  "section_groups_only"
    t.boolean  "section_due_dates_type",                         default: false
    t.boolean  "display_grader_names_to_students"
    t.boolean  "enable_test",                                    default: false,    null: false
    t.integer  "notes_count",                      limit: 4,     default: 0
    t.boolean  "assign_graders_to_criteria",                     default: false
    t.integer  "rubric_criterions_count",          limit: 4
    t.integer  "flexible_criterions_count",        limit: 4
    t.integer  "groupings_count",                  limit: 4
    t.integer  "tokens_per_day",                   limit: 4,     default: 0,        null: false
    t.boolean  "allow_remarks",                                  default: true,     null: false
    t.datetime "remark_due_date"
    t.text     "remark_message",                   limit: 65535
    t.float    "results_median",                   limit: 24
    t.integer  "results_fails",                    limit: 4
    t.integer  "results_zeros",                    limit: 4
    t.integer  "outstanding_remark_request_count", limit: 4
    t.boolean  "is_hidden",                                      default: false
    t.boolean  "only_required_files"
    t.boolean  "vcs_submit"
    t.boolean  "unlimited_tokens",                               default: false
  end

  add_index "assignments", ["short_identifier"], name: "index_assignments_on_short_identifier", unique: true, using: :btree

  create_table "criterion_ta_associations", force: :cascade do |t|
    t.integer  "ta_id",          limit: 4
    t.integer  "criterion_id",   limit: 4
    t.string   "criterion_type", limit: 255
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "assignment_id",  limit: 4
  end

  add_index "criterion_ta_associations", ["criterion_id"], name: "index_criterion_ta_associations_on_criterion_id", using: :btree
  add_index "criterion_ta_associations", ["ta_id"], name: "index_criterion_ta_associations_on_ta_id", using: :btree

  create_table "extra_marks", force: :cascade do |t|
    t.integer  "result_id",   limit: 4
    t.string   "description", limit: 255
    t.float    "extra_mark",  limit: 24
    t.datetime "created_at"
    t.datetime "updated_at"
    t.string   "unit",        limit: 255
  end

  add_index "extra_marks", ["result_id"], name: "index_extra_marks_on_result_id", using: :btree

  create_table "flexible_criteria", force: :cascade do |t|
    t.string   "flexible_criterion_name", limit: 255,                                        null: false
    t.text     "description",             limit: 65535
    t.integer  "position",                limit: 4
    t.integer  "assignment_id",           limit: 4,                                          null: false
    t.decimal  "max",                                   precision: 10, scale: 1,             null: false
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "assigned_groups_count",   limit: 4,                              default: 0
  end

  add_index "flexible_criteria", ["assignment_id", "flexible_criterion_name"], name: "index_flexible_criteria_on_assignment_id_and_name", unique: true, using: :btree
  add_index "flexible_criteria", ["assignment_id"], name: "index_flexible_criteria_on_assignment_id", using: :btree

  create_table "grace_period_deductions", force: :cascade do |t|
    t.integer  "membership_id", limit: 4
    t.integer  "deduction",     limit: 4
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  add_index "grace_period_deductions", ["membership_id"], name: "index_grace_period_deductions_on_membership_id", using: :btree

  create_table "grade_entry_forms", force: :cascade do |t|
    t.string   "short_identifier", limit: 255,   null: false
    t.string   "description",      limit: 255
    t.text     "message",          limit: 65535
    t.date     "date"
    t.datetime "created_at"
    t.datetime "updated_at"
    t.boolean  "show_total"
    t.boolean  "is_hidden"
  end

  add_index "grade_entry_forms", ["short_identifier"], name: "index_grade_entry_forms_on_short_identifier", unique: true, using: :btree

  create_table "grade_entry_items", force: :cascade do |t|
    t.integer  "grade_entry_form_id", limit: 4
    t.string   "name",                limit: 255,                 null: false
    t.datetime "created_at"
    t.datetime "updated_at"
    t.float    "out_of",              limit: 24
    t.integer  "position",            limit: 4
    t.boolean  "bonus",                           default: false
  end

  add_index "grade_entry_items", ["grade_entry_form_id", "name"], name: "index_grade_entry_items_on_grade_entry_form_id_and_name", unique: true, using: :btree

  create_table "grade_entry_students", force: :cascade do |t|
    t.integer  "user_id",             limit: 4
    t.integer  "grade_entry_form_id", limit: 4
    t.boolean  "released_to_student"
    t.datetime "created_at"
    t.datetime "updated_at"
    t.float    "total_grade",         limit: 24
  end

  add_index "grade_entry_students", ["user_id", "grade_entry_form_id"], name: "index_grade_entry_students_on_user_id_and_grade_entry_form_id", unique: true, using: :btree

  create_table "grade_entry_students_tas", force: :cascade do |t|
    t.integer "grade_entry_student_id", limit: 4
    t.integer "ta_id",                  limit: 4
  end

  create_table "grades", force: :cascade do |t|
    t.integer  "grade_entry_item_id",    limit: 4
    t.integer  "grade_entry_student_id", limit: 4
    t.float    "grade",                  limit: 24
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  add_index "grades", ["grade_entry_item_id", "grade_entry_student_id"], name: "index_grades_on_grade_entry_item_id_and_grade_entry_student_id", unique: true, using: :btree

  create_table "grouping_queues", force: :cascade do |t|
    t.integer "submission_collector_id", limit: 4
    t.boolean "priority_queue",                    default: false
  end

  create_table "groupings", force: :cascade do |t|
    t.integer  "group_id",                limit: 4,                 null: false
    t.integer  "assignment_id",           limit: 4,                 null: false
    t.datetime "created_at"
    t.datetime "updated_at"
    t.boolean  "admin_approved",                    default: false, null: false
    t.integer  "grouping_queue_id",       limit: 4
    t.boolean  "is_collected",                      default: false
    t.integer  "notes_count",             limit: 4, default: 0
    t.integer  "criteria_coverage_count", limit: 4, default: 0
    t.boolean  "error_collecting",                  default: false
  end

  add_index "groupings", ["assignment_id", "group_id"], name: "groupings_u1", unique: true, using: :btree
  add_index "groupings", ["group_id"], name: "fk_groupings_groups", using: :btree

  create_table "groupings_tags", id: false, force: :cascade do |t|
    t.integer "tag_id",      limit: 4, null: false
    t.integer "grouping_id", limit: 4, null: false
  end

  add_index "groupings_tags", ["tag_id", "grouping_id"], name: "index_groupings_tags_on_tag_id_and_grouping_id", unique: true, using: :btree

  create_table "groups", force: :cascade do |t|
    t.string "group_name", limit: 30
    t.string "repo_name",  limit: 255
  end

  add_index "groups", ["group_name"], name: "groups_name_unique", unique: true, using: :btree

  create_table "key_pairs", force: :cascade do |t|
    t.integer  "user_id",    limit: 4
    t.string   "user_name",  limit: 255
    t.string   "file_name",  limit: 255
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  create_table "marking_schemes", force: :cascade do |t|
    t.string   "name",       limit: 255
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  create_table "marking_weights", force: :cascade do |t|
    t.integer  "marking_scheme_id", limit: 4
    t.integer  "gradable_item_id",  limit: 4
    t.decimal  "weight",                      precision: 10
    t.datetime "created_at"
    t.datetime "updated_at"
    t.boolean  "is_assignment",                              null: false
  end

  create_table "marks", force: :cascade do |t|
    t.integer  "result_id",     limit: 4
    t.integer  "markable_id",   limit: 4
    t.float    "mark",          limit: 24
    t.datetime "created_at"
    t.datetime "updated_at"
    t.string   "markable_type", limit: 255
  end

  add_index "marks", ["markable_id", "result_id", "markable_type"], name: "marks_u1", unique: true, using: :btree
  add_index "marks", ["markable_id"], name: "index_marks_on_markable_id", using: :btree
  add_index "marks", ["result_id"], name: "index_marks_on_result_id", using: :btree

  create_table "memberships", force: :cascade do |t|
    t.integer  "user_id",           limit: 4
    t.string   "membership_status", limit: 255
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "grouping_id",       limit: 4,   null: false
    t.string   "type",              limit: 255
  end

  add_index "memberships", ["grouping_id", "user_id"], name: "memberships_u1", unique: true, using: :btree
  add_index "memberships", ["user_id"], name: "fk_memberships_users", using: :btree

  create_table "notes", force: :cascade do |t|
    t.text     "notes_message", limit: 65535, null: false
    t.integer  "creator_id",    limit: 4,     null: false
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "noteable_id",   limit: 4,     null: false
    t.string   "noteable_type", limit: 255,   null: false
  end

  add_index "notes", ["creator_id"], name: "index_notes_on_creator_id", using: :btree

  create_table "periods", force: :cascade do |t|
    t.integer  "submission_rule_id",   limit: 4
    t.float    "deduction",            limit: 24
    t.datetime "created_at"
    t.datetime "updated_at"
    t.float    "hours",                limit: 24
    t.float    "interval",             limit: 24
    t.string   "submission_rule_type", limit: 255
  end

  add_index "periods", ["submission_rule_id"], name: "index_periods_on_submission_rule_id", using: :btree

  create_table "results", force: :cascade do |t|
    t.integer  "submission_id",        limit: 4
    t.string   "marking_state",        limit: 255
    t.text     "overall_comment",      limit: 65535
    t.datetime "created_at"
    t.datetime "updated_at"
    t.boolean  "released_to_students",               default: false, null: false
    t.float    "total_mark",           limit: 24,    default: 0.0
  end

  add_index "results", ["submission_id"], name: "fk_results_submissions", using: :btree

  create_table "rubric_criteria", force: :cascade do |t|
    t.string   "rubric_criterion_name", limit: 255,               null: false
    t.integer  "assignment_id",         limit: 4,                 null: false
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "position",              limit: 4
    t.text     "level_0_name",          limit: 65535
    t.text     "level_0_description",   limit: 65535
    t.text     "level_1_name",          limit: 65535
    t.text     "level_1_description",   limit: 65535
    t.text     "level_2_name",          limit: 65535
    t.text     "level_2_description",   limit: 65535
    t.text     "level_3_name",          limit: 65535
    t.text     "level_3_description",   limit: 65535
    t.text     "level_4_name",          limit: 65535
    t.text     "level_4_description",   limit: 65535
    t.float    "weight",                limit: 24,                null: false
    t.integer  "assigned_groups_count", limit: 4,     default: 0
  end

  add_index "rubric_criteria", ["assignment_id", "rubric_criterion_name"], name: "rubric_critera_index_1", unique: true, using: :btree

  create_table "section_due_dates", force: :cascade do |t|
    t.datetime "due_date"
    t.integer  "section_id",    limit: 4
    t.integer  "assignment_id", limit: 4
  end

  create_table "sections", force: :cascade do |t|
    t.string   "name",       limit: 255
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  create_table "sessions", force: :cascade do |t|
    t.string   "session_id", limit: 255,   null: false
    t.text     "data",       limit: 65535
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  add_index "sessions", ["session_id"], name: "index_sessions_on_session_id", using: :btree
  add_index "sessions", ["updated_at"], name: "index_sessions_on_updated_at", using: :btree

  create_table "submission_collectors", force: :cascade do |t|
    t.integer "child_pid",                limit: 4
    t.boolean "stop_child",                         default: false
    t.boolean "safely_stop_child_exited",           default: false
  end

  create_table "submission_files", force: :cascade do |t|
    t.integer "submission_id",    limit: 4
    t.string  "filename",         limit: 255
    t.string  "path",             limit: 255, default: "/",   null: false
    t.boolean "is_converted",                 default: false
    t.boolean "error_converting",             default: false
  end

  add_index "submission_files", ["filename"], name: "index_submission_files_on_filename", using: :btree
  add_index "submission_files", ["submission_id"], name: "index_submission_files_on_submission_id", using: :btree

  create_table "submission_rules", force: :cascade do |t|
    t.integer  "assignment_id", limit: 4,                                    null: false
    t.string   "type",          limit: 255, default: "NoLateSubmissionRule"
    t.datetime "created_at"
    t.datetime "updated_at"
  end

  add_index "submission_rules", ["assignment_id"], name: "index_submission_rules_on_assignment_id", using: :btree

  create_table "submissions", force: :cascade do |t|
    t.integer  "grouping_id",              limit: 4
    t.datetime "created_at"
    t.integer  "submission_version",       limit: 4
    t.boolean  "submission_version_used"
    t.integer  "revision_number",          limit: 4,     null: false
    t.datetime "revision_timestamp",                     null: false
    t.integer  "remark_result_id",         limit: 4
    t.text     "remark_request",           limit: 65535
    t.datetime "remark_request_timestamp"
  end

  add_index "submissions", ["grouping_id"], name: "index_submissions_on_grouping_id", using: :btree

  create_table "tags", force: :cascade do |t|
    t.string  "name",        limit: 255, null: false
    t.string  "description", limit: 255
    t.integer "user_id",     limit: 4
  end

  add_index "tags", ["user_id"], name: "index_tags_on_user_id", using: :btree

  create_table "test_results", force: :cascade do |t|
    t.integer "grouping_id",           limit: 4
    t.integer "test_script_id",        limit: 4
    t.integer "test_script_result_id", limit: 4
    t.string  "name",                  limit: 255
    t.string  "completion_status",     limit: 255,   null: false
    t.integer "marks_earned",          limit: 4,     null: false
    t.integer "repo_revision",         limit: 4
    t.text    "input_description",     limit: 65535, null: false
    t.text    "actual_output",         limit: 65535, null: false
    t.text    "expected_output",       limit: 65535, null: false
    t.integer "submission_id",         limit: 4
  end

  add_index "test_results", ["grouping_id", "test_script_id"], name: "grouping_id_and_test_script_id", using: :btree

  create_table "test_script_results", force: :cascade do |t|
    t.integer  "grouping_id",    limit: 4
    t.integer  "test_script_id", limit: 4
    t.integer  "marks_earned",   limit: 4
    t.integer  "repo_revision",  limit: 4
    t.datetime "created_at"
    t.datetime "updated_at"
    t.integer  "submission_id",  limit: 4
  end

  create_table "test_scripts", force: :cascade do |t|
    t.integer "assignment_id",           limit: 4,     null: false
    t.float   "seq_num",                 limit: 24,    null: false
    t.string  "script_name",             limit: 255,   null: false
    t.text    "description",             limit: 65535, null: false
    t.integer "max_marks",               limit: 4,     null: false
    t.boolean "run_on_submission"
    t.boolean "run_on_request"
    t.boolean "halts_testing"
    t.string  "display_description",     limit: 255,   null: false
    t.string  "display_run_status",      limit: 255,   null: false
    t.string  "display_marks_earned",    limit: 255,   null: false
    t.string  "display_input",           limit: 255,   null: false
    t.string  "display_expected_output", limit: 255,   null: false
    t.string  "display_actual_output",   limit: 255,   null: false
  end

  add_index "test_scripts", ["assignment_id", "seq_num"], name: "index_test_scripts_on_assignment_id_and_seq_num", using: :btree

  create_table "test_support_files", force: :cascade do |t|
    t.string  "file_name",     limit: 255,   null: false
    t.integer "assignment_id", limit: 4,     null: false
    t.text    "description",   limit: 65535, null: false
  end

  add_index "test_support_files", ["assignment_id"], name: "index_test_files_on_assignment_id", using: :btree

  create_table "tokens", force: :cascade do |t|
    t.integer "grouping_id",          limit: 4
    t.integer "tokens",               limit: 4
    t.date    "last_token_used_date"
  end

  create_table "users", force: :cascade do |t|
    t.string   "user_name",     limit: 255,                 null: false
    t.string   "last_name",     limit: 255
    t.string   "first_name",    limit: 255
    t.integer  "grace_credits", limit: 4,   default: 0,     null: false
    t.string   "type",          limit: 255
    t.datetime "created_at"
    t.datetime "updated_at"
    t.boolean  "hidden",                    default: false, null: false
    t.string   "api_key",       limit: 255
    t.integer  "section_id",    limit: 4
    t.integer  "notes_count",   limit: 4,   default: 0
  end

  add_index "users", ["user_name"], name: "index_users_on_user_name", unique: true, using: :btree

  add_foreign_key "annotation_texts", "annotation_categories", name: "fk_annotation_labels_annotation_categories", on_delete: :cascade
  add_foreign_key "annotations", "annotation_texts", name: "fk_annotations_annotation_texts"
  add_foreign_key "annotations", "submission_files", name: "fk_annotations_submission_files"
  add_foreign_key "assignment_files", "assignments", name: "fk_assignment_files_assignments", on_delete: :cascade
  add_foreign_key "assignment_stats", "assignments", name: "fk_assignment_stats_assignments", on_delete: :cascade
  add_foreign_key "extra_marks", "results", name: "fk_extra_marks_results", on_delete: :cascade
  add_foreign_key "groupings", "assignments", name: "fk_groupings_assignments"
  add_foreign_key "groupings", "groups", name: "fk_groupings_groups"
  add_foreign_key "marks", "results", name: "fk_marks_results", on_delete: :cascade
  add_foreign_key "memberships", "groupings", name: "fk_memberships_groupings"
  add_foreign_key "memberships", "users", name: "fk_memberships_users"
  add_foreign_key "results", "submissions", name: "fk_results_submissions", on_delete: :cascade
  add_foreign_key "rubric_criteria", "assignments", name: "fk_rubric_criteria_assignments", on_delete: :cascade
  add_foreign_key "submission_files", "submissions", name: "fk_submission_files_submissions"
  add_foreign_key "tags", "users"
end
