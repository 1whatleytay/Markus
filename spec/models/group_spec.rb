require 'spec_helper'

describe Group do
  subject(:group) { build_stubbed(:group) }

  it 'is valid with a group name' do
    expect(group).to be_valid
  end

  it 'is invalid without a group name' do
    g = build_stubbed(:group, group_name: nil)
    expect(g).to have(1).errors_on(:group_name)
  end

  it 'is invalid with a duplicate group name' do
    # The factory for group assigns group_name with 'g2markus'
    # by default, therefore to cause the duplication error
    # another group with the same name is created.
    create(:group, group_name: 'g2markus')
    expect(group).to have(1).errors_on(:group_name)
  end

  it 'is invalid with a group name longer than 30 characters' do
    g = build_stubbed(:group,
                      group_name: 'g2thisnameiswaylongerthan30characters')
    expect(g).to have(1).errors_on(:group_name)
  end

  describe '#set_repo_name' do
    # The tests below are checking for a method that is called when
    # the group is initially created, so it is not explicitly called here.
    context 'when name is specified' do
      it 'saves specified name' do
        g = build_stubbed(:group,
                          group_name: 'g2markus',
                          repo_name: 'g2markus')
        expect(g.repo_name).to eq 'g2markus'
      end
    end

    context 'when name is not specified' do
      it 'saves autogenerated name' do
        g = create(:group, group_name: 'g2markus')
        expect(g.repo_name).to start_with('group_')
      end
    end
  end
end
