<%
# Erb template for display rubric criterion in the grader view
%>

<li class="criterion_holder" id="<%= "criterion_#{criterion.id}" %>">

  <div class="criterion_title_div" id="<%= "criterion_title_#{criterion.id}"%>" onclick="<%="focus_criterion(#{criterion.id})"%>">

    <div id="<%="criterion_title_#{criterion.id}_expand"%>" style="float:left;">+ &nbsp;</div>
    <div id="<%="criterion_title_#{criterion.id}_name"%>" class="criterion_title_div_level" style="float:left;">
      <b><%=criterion.name%></b>
    </div>
    <div class="clear"></div>
    <div id="<%="criterion_title_#{mark.id}_mark"%>" style="padding-left:30px;">
      <% if !mark.mark.nil? -%>
        <b>
          <%= mark.mark %>&nbsp;
          <%= criterion["level_" + mark.mark.to_s + "_name"] %>&nbsp;
        </b>
        <%= criterion["level_" + mark.mark.to_s + "_description"] %>
      <% end -%>
    </div>
    <div class="clear"></div>

  </div> <!-- Title Div -->

  <div id="<%="criterion_inputs_#{criterion.id}"%>" class="criterion_level_container" style="display:none;">

    <div style="float:left;">
      <% form_tag({}, {:id => "mark_form_#{criterion.id}"}) do %>
        <table>
        <% num_levels = 0
        selected = false
        while (num_levels < 5) 
          level_name = criterion["level_" + num_levels.to_s + "_name"]
          level_desc = criterion["level_" + num_levels.to_s + "_description"]
          if (num_levels == mark.mark)
            selected = true
          else
            selected = false
          end
        -%>
          <% if level_desc && !level_desc.empty? -%>
            <tr>
               <td><%= radio_button_tag :mark, num_levels, selected %></td>
               <td><b><%= level_name %></b>
                  <%=level_desc%></td>
            </tr>
         <% end -%>

        <% num_levels = num_levels + 1
          end -%>
          </table>
      <% end -%>
      <%= observe_form "mark_form_#{criterion.id}", :url => { :action => 'update_mark', :mark_id=>mark.id}, :before => "element.disable();$('working').show();", :complete => "element.enable();$('working').hide();" -%>
    </div>

    <div class="clear"></div>

  </div>

</li>
