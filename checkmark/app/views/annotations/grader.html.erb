<%= stylesheet_link_tag("annotations") %>
<%= stylesheet_link_tag("rubrics") %>
<%= javascript_include_tag "tooltip.js" %>
<%= javascript_include_tag "selecttext.js" %>
<%= javascript_include_tag "syntaxhighlighter/shCore.js" %>
<%= javascript_include_tag "syntaxhighlighter/shBrushJava.js" %>
<%= javascript_include_tag "syntaxhighlighter/shBrushXml.js" %>
<script>
var tool_tips = $A();

//After DOM is loaded, load up the first submitted file
document.observe("dom:loaded", function() {
  load_submitted_file('<%=@files[0].id%>');
});

//Load a submitted file into the code-viewer based on file id's
function load_submitted_file(fid) {
<%= remote_function (:update => "codeviewer",
                   :url =>{ :action => "codeviewer", :id => @assignment.id, :uid => @uid },
                   :with => "'fid='+fid")%>
}

function make_new_annotation() {

  var new_annotation_text = prompt('Please enter your annotation text');

  if (new_annotation_text == null) {
    return false;
  }
  if (new_annotation_text.strip() == '') {
    alert('You must provide some annotation text');
    return false;
  }

  <%= remote_function (
                    :url => { :action => "create" },
                    :with => "'fid='+ $('select_file_id').value +'&line_start=' + positions.line_start + ' &line_end=' + positions.line_end + '&annotation_text='+ escape(new_annotation_text)",
                    :before => "positions = getSelectedLines($('code'));")
                    %>

}

function render_annotation_label(id, content) {
  var annot_label = new Element('div', 
      {'class': 'annotation', 
       'id': 'annotation_'+id,
       'style': 'display:none;'
      }).update(content);
  $('annotation_holder').insert(annot_label);
}

function add_tool_tip(node, annotation_id) {
  var new_tool_tip = new Tooltip(node, "annotation_" + annotation_id);
  tool_tips.push(new_tool_tip);  
}
</script>

<h1>Grading Assignment: <%= link_to @assignment.name, :controller => 'annotations', :action => 'students', :id => @assignment.id %> </h1>

<select id="select_file_id" name="select_file_id" onChange="load_submitted_file($(this).value)">
    <% @files.each do |file| %>
        <option value="<%= file.id %>"> 
          <%= file.filename %>
        </option>
    <% end %>
</select>

<div id="code_pane" style="float:left;">
<button id="highlight_button" onClick="make_new_annotation();">Highlight Selection</button>
  <div id="codeviewer">
  </div>
</div>
<div id="rubric_viewer" style="float:left;">

    <% @rubric_criteria.each do |criterion| %>
      <div class="criterion_holder">      
        <p><%=criterion.name%></p>
        <p><%=criterion.description%></p>
        <ul>
          <li>
            <input type="radio" name="rubric_criterion_<%=criterion.id%>"><%=criterion.level_0_name%>
            <p><%=criterion.level_0_description%></p>
          </li>
          <li>
            <input type="radio" name="rubric_criterion_<%=criterion.id%>"><%=criterion.level_1_name%>
            <p><%=criterion.level_1_description%></p>
          </li>
          <li>
            <input type="radio" name="rubric_criterion_<%=criterion.id%>"><%=criterion.level_2_name%>
            <p><%=criterion.level_2_description%></p>
          </li>
          <li>
            <input type="radio" name="rubric_criterion_<%=criterion.id%>"><%=criterion.level_3_name%>
            <p><%=criterion.level_3_description%></p>
          </li>
          <li>
            <input type="radio" name="rubric_criterion_<%=criterion.id%>"><%=criterion.level_4_name%>
            <p><%=criterion.level_4_description%></p>
          </li>

        </ul>
      </div>
    <% end %>
  

</div>

<div id="annotation_holder">
</div>
