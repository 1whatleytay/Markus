<%= stylesheet_link_tag("livepipe/tabs") %>
<%= stylesheet_link_tag("rubrics") %>
<%= javascript_include_tag  'livepipe/livepipe' %>
<%= javascript_include_tag  'livepipe/tabs' %>
<%= javascript_include_tag  'rubrics' %>
<script>
var create_num = <%=@assignment.rubric_criterias.length%> + 1;
var authenticity_token = '<%=form_authenticity_token%>';
var selected_criterion_id = null;
var xhr_in_progress = false;
var activate_upload_tab = false;
<% if flash[:invalid_lines] && !flash[:invalid_lines].empty? -%>
  activate_upload_tab = true;
<% end -%>
</script>

<h1>Rubric Management:  <%= @assignment.name %></h1>	

<p><%= link_to '&#171; Back to Manage Assignments', :controller => 'assignments', :action => 'index' %></p>

<% if flash[:upload_notice] && flash[:invalid_lines].empty? -%>
<div>
  <p class="success"><%=h flash[:upload_notice] %></p>
</div>
<% end -%>

<!-- Needed: rubric_tags, tab -->
<ul id="rubric_tabs" class="subsection_tabs">
	<li class="tab"><a href="#manually_edit_rubric_canvas">Manually Edit Rubric</a></li>
	<li class="tab"><a href="#upload_rubric_file_canvas">Upload Rubric File</a></li>
</ul>

<!-- Need for the tabs -->
<div id="manually_edit_rubric_canvas">

  <input type="text" id="pull_focus" value="Hidden field to pull focus" style="display: none;">
  
  <div id="rubric_criteria_pane">
  
    <div id="rubric_criteria_pane_menu">
      <h2>Rubric Criteria</h2>
      <!--  Gives controller and instruction
            Views can be dynamic
            Controller: add_action, with the id,
            :with => attach these parameters
            :before => before the counters
            Also passing the number of critieras
      -->
    <span class="link"><%= link_to_remote 'Add Criterion', :url => { :action => 'add_criterion', :id => @assignment.id}, :with => "'create_num='+create_num", :before => "create_num++;" %></span>
    </div> <!-- Rubric Criteria Pane Menu -->
    
    <ul id="rubric_criteria_pane_list">
      <% @criteria.each do |criterion| -%>
        <%= render :partial => "rubrics/manage/criterion", :locals => {:criterion => criterion} %>
      <% end -%>
    </ul>
    
    <%= sortable_element("rubric_criteria_pane_list", :handle=> 'div', :url => { :action => "update_positions" }) %>		
    
  </div>  <!-- Rubric Criteria Pane -->
  
  <div id="rubric_levels_pane">

    <div id="rubric_levels_pane_menu">
      <h2>Rubric Levels: <span id="selected_criterion_name"></span></h2>
    </div> <!-- rubric level menu -->

    <div id="rubric_levels_pane_list">
    </div> <!-- Rubric Levels Pane List -->
          
  </div> <!-- Rubric Levels Pane -->

</div> <!-- Edit Canvas -->

<div id="upload_rubric_file_canvas">

  <h2>Upload Rubric File</h2>
  
  <p>
  Select a CSV or YAML file to upload
  <!-- Need a better message
  Select a CSV file of the following form:<br /><br />
  <code>level1_name,level2_name,level3_name,level4_name,level5_name <br />
        criterion,weight,level0_desc,level1_desc,level2_desc,level3_desc,level4_desc<br />
        ...</code><br />-->
  </p>

  <p>
    <% form_for :upload_rubric, :html => {:multipart => true}, :url => { :controller=>"rubrics",
										:action => 'upload_rubric',
										:id => @assignment.id,
										:html => {:multipart => true }} do |f| -%>
		<p>
	      <%= f.file_field :rubric %>
		</p>
        <p> File type: &nbsp;
          <%= f.radio_button :file_type, "csv", :checked => "checked" %>csv &nbsp;
          <%= f.radio_button :file_type, "yml" %>yml
        </p>
		<p>
			<%= submit_tag("Submit") %>
		</p>
	   <% end %>
  </p>
  
  <% # display lines in csv file that has not been successfully processed %>
  <% if flash[:invalid_lines] && !flash[:invalid_lines].empty? -%>
  <div class="errorExplanation" id="errorExplanation">
    <h2>The following criteria has not been successfully added:</h2>
    <br />
    <ul style="padding-left:20px;">
      <% for line in flash[:invalid_lines] -%>
      <li><%=h line %></li>
      <% end -%>
    </ul>
    <h5>Make sure that:</h5>
    <ul style="padding-left:20px;">
      <li>There are no more than 5 rubric levels</li>
      <li>Criterion weight is numeric</li>
      <li>Each field is separated by a comma</li>
      <li>Each line has the required fields specified above</li>
    </ul>
  </div>
  <% end -%>

</div> <!-- Upload canvas -->
