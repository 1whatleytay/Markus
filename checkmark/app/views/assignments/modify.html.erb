<h1><%=h @title %></h1>

<p>
<% if (action == 'update') %>
<%= link_to "Manage Rubric for this assignment", 
  :controller => 'rubrics', :action => 'index', :id => @assignment.id %></p>
<% end %>

<% form_for :assignment, :url => {:action => action, :id => params[:id] } do |f| -%>

<fieldset>
  <legend>Assignment Properties</legend>

  <%= error_messages_for :assignment, :assignment_files, :object => @assignment.submission_rule %>
  
  <p>
    <%= f.label :name %><br />
    <%= f.text_field :name %>
  </p>
  <p>
    <%= f.label :description %><br />
    <%= f.text_field :description %>
  </p>
  <p>
    <%= f.label :message %> (Optional)<br />
    <%= f.text_area :message, :rows => 5 %>
  </p>
  <p>
    <%= f.label "This assignment is due on:"%>
    <%= f.datetime_select "due_date", :default => 3.hours.from_now %>
  </p>

  <h4>Add filename(s) that students would be required to submit:</h4>
  <%# render the link instead of embedding, to dynamically update 
        the index of the next file text field -%>
  <%= render :partial => 'add_file_link', 
    :locals => { :index => @assignment.assignment_files.size } %>
  
  <p id="files">
    <% @assignment.assignment_files.each_with_index do |file, index| -%>
      <%= render :partial => 'file_fields', :locals => { :file => file, :index => index } -%>
    <% end -%> 
  </p>
</fieldset>
  
  
<fieldset>
  <legend>Group Properties</legend>

  <p>
    Group Limit (must be 1 or more):
    from <%= f.text_field :group_min, :size => 5, :maxlength => 3 %>
    to <%= f.text_field :group_max, :size => 5, :maxlength => 3 %>
    people in a group.
  </p>

  <p>
    Allow students to form their own groups
    <%= f.check_box :student_form_groups %>
  </p>

  <p>
    Allow students to invite members to the group until: <br />
    <%= f.datetime_select :student_invite_until, :default => 1.days.from_now %>
  </p>
</fieldset>


<fieldset>
  <legend>Submission Rules</legend>

  <%- fields_for :submission_rule, @assignment.submission_rule do |rule| -%>
    <p>
      Allow students to submit 
      <%= rule.text_field :allow_submit_until, :size => 3 %> 
      hours after deadline
    </p>

    <h5>Choose penalty rules to apply for late submissions:</h5>

    <p>
      <%= rule.radio_button :type, "NullSubmissionRule" %>
      No penalty for late submissions
    </p>

    <p>
      <%= rule.radio_button :type, "GraceDaySubmissionRule" %>
      Automatically deduct grace days
    </p>

    <p>
      Allow students to use up to 
      <%= rule.text_field :grace_day_limit, :size => 3 %> 
      grace days for this assignment.
    </p>
  
    <p>
      <%= rule.radio_button :type, "PenaltySubmissionRule" %>
      Use Penalty Formula
    </p>

    <p>
      Deduct at most <%= rule.text_field :penalty_limit, :size => 3 %> points 
      in increments of <%= rule.text_field :penalty_increment, :size => 3 %> for every 
      <%= rule.text_field :penalty_interval, :size => 3 %>
      <%= rule.select :penalty_interval_unit, ["days", "hours", "minutes"] %>
      late.
    </p>
  <%- end -%>
</fieldset>



  <p><%= f.submit @submit_text, :name => action %></p>


<% end %>

<%= link_to '< Cancel', :action => 'index' %>

